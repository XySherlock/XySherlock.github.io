<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>XySherlock&#39;s Secret Base</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="XySherlock&#39;s Secret Base">
<meta property="og:url" content="https://XySherlock.github.io/index.html">
<meta property="og:site_name" content="XySherlock&#39;s Secret Base">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XySherlock&#39;s Secret Base">
  
    <link rel="alternate" href="/atom.xml" title="XySherlock&#39;s Secret Base" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/XySher.png">
    <h2 class="author">XySherlock</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>19</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>5</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-diary" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2999/01/01/diary/" class="article-date">
  <time class="post-time" datetime="2998-12-31T16:00:01.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">01</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2999/01/01/diary/">XysDiary</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="22-03-28"><a href="#22-03-28" class="headerlink" title="22-03-28"></a>22-03-28</h1><p>收到恒润的拒信了。投大厂杳无音信，小厂面完就拒，已经逐渐习惯了。技术不行又贪玩还楞是这样的呀。考虑三战了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2999/01/01/diary/" data-id="cl1a7aerm0000psu8a3hl22ho" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Diary/">Diary</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Router-Day05" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/09/Router-Day05/" class="article-date">
  <time class="post-time" datetime="2022-01-09T08:38:03.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">09</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/09/Router-Day05/">Router Day05 ：HTTP</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>Web server is vulnerable in router. And for communicating with the web server, HTTP protocol is essential. </p>
<p>For HTTP request ,I guess the writer used the IBM Doc.(<a href="https://www.ibm.com/docs/en/cics-ts/5.3?topic=protocol-http-requests" target="_blank" rel="noopener">https://www.ibm.com/docs/en/cics-ts/5.3?topic=protocol-http-requests</a>)</p>
<p>A correctly composed HTTP request contains the following elements:<br>1.A request line.<br>2.A series of HTTP headers, or header fields.<br>3.A message body, if needed.  </p>
<h3 id="HTTP-request-line"><a href="#HTTP-request-line" class="headerlink" title="HTTP request line"></a>HTTP request line</h3><p>Request line begins with a method,separated by spaces ,followed by requested URI and version of protocol.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Method Request-URI HTTP-Version CRLF // template</span><br><span class="line">GET /software/htp/cics/index.html HTTP/1.1 // instance</span><br></pre></td></tr></table></figure></p>
<p>CRLF means ‘Carriage return and line feed ‘.And Method can be seen from the pic below.<br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220109_01.PNG" alt="Image"> </p>
<p>GET: just simple coding, Using GET to submit form data introduces security risks. And it can’t submit large amouts of data.<br>POST: A replacement for GET. Used to submit form data to Web server.Especially large amounts of data.</p>
<h3 id="HTTP-message-header"><a href="#HTTP-message-header" class="headerlink" title="HTTP message header"></a>HTTP message header</h3><p>HTTP message is formed with C-S request and S-C response.HTTP message inclues request message and response message. We can structure this as fuzzing data. Request should be cared while responses do not.</p>
<p>Request message header allow clients send request as additional information and the information of client itself.<br><strong>The format is like : Name +:+space+value</strong><br>message header:<br>Accept :Tell what source c wants to acc.<br>Accept-ENcoding: Specify acceptable content encoding.<br><strong>Cookie: Give server cookie check.</strong><br>Accept-Language: Specify a language.<br>Authorizaiton: Prove the right of  C to check some source. (S-C:401 C-S:Authrization)<br>Host: Specify the host and port number of the source provider. Usually taken from HTTP URL. <strong>Necessary when sending request.</strong><br>User-Agent: Allow C give its OS,browser,and other attributes to S. It’s not necessary.</p>
<h3 id="HTTP-message-body"><a href="#HTTP-message-body" class="headerlink" title="HTTP message body"></a>HTTP message body</h3><p><strong>Between header and body there is a blank line means the end of header</strong><br>Body includes the submit from C of enquiry string message or etc.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2022/01/09/Router-Day05/" data-id="cl1a78kkx000xsgu8bx2ngszd" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/">IoT</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Router-Day04" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/07/Router-Day04/" class="article-date">
  <time class="post-time" datetime="2022-01-07T11:51:21.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">07</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/07/Router-Day04/">Router Day04：MIPS32</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="MIPS-Assembly-language"><a href="#MIPS-Assembly-language" class="headerlink" title="MIPS Assembly language"></a>MIPS Assembly language</h2><p>I use the book(34-38) mentioned to learn this, while this url can also be learned:<a href="https://blog.csdn.net/ben_chong/article/details/51794392" target="_blank" rel="noopener">https://blog.csdn.net/ben_chong/article/details/51794392</a>  </p>
<p>Rs:First source operand register<br>Rt:Second source operand register<br>Rd: store destination operand for operation result  </p>
<h4 id="Pipeline-Effect"><a href="#Pipeline-Effect" class="headerlink" title="Pipeline Effect"></a><strong>Pipeline Effect</strong></h4><h3 id="1-LOAD-STORE"><a href="#1-LOAD-STORE" class="headerlink" title="(1)LOAD/STORE"></a>(1)LOAD/STORE</h3><p>Load Adress: load a addr or a label<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">la $Rd,Label //$Rd=Label;</span><br></pre></td></tr></table></figure></p>
<p>Load Immediate: load a immediate into a register<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li $Rd,imm //$Rd=imm;</span><br></pre></td></tr></table></figure></p>
<p>Load Word: load a <strong>word type value</strong> from a given addr to a register<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lw $Rt,offset($Rs) //$Rt=MEM[$Rs+0];</span><br></pre></td></tr></table></figure></p>
<p>Store Word: save the value from source register to given addr<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sw $Rt,offset($Rs) //Mem[$sp+0]=$a0;</span><br></pre></td></tr></table></figure></p>
<p>Move: pass values from register to register<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move $t5,$t1 //$t5=$t1;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-Arithmetic-operation-instructions"><a href="#2-Arithmetic-operation-instructions" class="headerlink" title="(2)Arithmetic operation instructions"></a>(2)Arithmetic operation instructions</h3><p><strong>All these instructions only get register as operand No RAM addr or indirect addressing!!!</strong><br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220107_01.PNG" alt="Image"><br>For multiply and dive , HI&amp;LO shall be used differently.</p>
<h3 id="3-Class-comparison-instruction"><a href="#3-Class-comparison-instruction" class="headerlink" title="(3)Class comparison instruction"></a>(3)Class comparison instruction</h3><p>MIPS don’t get a flag register. But there is a series of instructions:SLT series of instructions.That can be used as a companion with branch instructions after compare set some register .</p>
<p>SLT:<strong>Signed</strong>$Rs&lt;$Rt,$Rd=1 or $Rd=0<br><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">slt </span>$Rd,$Rs,Rt</span><br></pre></td></tr></table></figure></p>
<p>SLTI:<strong>Signed</strong> $Rs &lt; Imm, $Rt=1 or $Rt=0<br><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">slti </span>$Rt,$Rs,Imm</span><br></pre></td></tr></table></figure></p>
<p>SLTU:<strong>Unsigned</strong> $Rs&lt;$Rt , $Rd=1 or $Rd=0<br><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sltu </span>$Rd,$Rs,$Rt</span><br></pre></td></tr></table></figure></p>
<p>SLTIU:<strong>UnSigned</strong> $Rs &lt; Imm, $Rt=1 or $Rt=0<br><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sltu </span>$Rt,$Rs,Imm</span><br></pre></td></tr></table></figure></p>
<p>In SLT when there goes 3 arguments , the first is always the one to be set 1 or 0?</p>
<h3 id="4-SYSCALL"><a href="#4-SYSCALL" class="headerlink" title="(4)SYSCALL"></a>(4)SYSCALL</h3><p>Make a soft interrupt to make a sys call. The [system call number] puts in $v0 , arguments are in $a0~$a3.<br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220107_02.PNG" alt="Image">  </p>
<h3 id="5-Branch-instruction"><a href="#5-Branch-instruction" class="headerlink" title="(5)Branch instruction"></a>(5)Branch instruction</h3><p>Jump by comparing the values between 2 registers. So to jump with imm, put imm into register first.<br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220107_03.PNG" alt="Image">  </p>
<h3 id="6-Jump-instruction"><a href="#6-Jump-instruction" class="headerlink" title="(6)Jump instruction"></a>(6)Jump instruction</h3><p><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220107_04.PNG" alt="Image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2022/01/07/Router-Day04/" data-id="cl1a78kkv000vsgu89yhegcon" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/">IoT</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Data-Structure-01" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/06/Data-Structure-01/" class="article-date">
  <time class="post-time" datetime="2022-01-06T10:01:41.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">06</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/06/Data-Structure-01/">Data Structure Day01</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>To learn about Data Structure, I choose the course from Tsinghua University on Mooc.</p>
<h1 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h1><h2 id="A-1"><a href="#A-1" class="headerlink" title="A.1"></a>A.1</h2><p>‘Computing’ &amp; ‘Computer’</p>
<h2 id="A-2"><a href="#A-2" class="headerlink" title="A.2"></a>A.2</h2><h3 id="‘Rope-Computer’"><a href="#‘Rope-Computer’" class="headerlink" title="‘Rope Computer’"></a>‘Rope Computer’</h3><p>Input:Line L &amp; a point on L called A</p>
<p>Output:Make a perpendicular to L throu A</p>
<p>Take 12 part equal rope ,set A+4 B , set A-3 C ;</p>
<p>then put A&amp;B on rope on the ‘L’ then make a triangel.</p>
<p>“computer”: tool that can be used <strong>repeatedly and mechanically</strong></p>
<h2 id="A-3"><a href="#A-3" class="headerlink" title="A.3"></a>A.3</h2><h3 id="‘Ruler-Computer’"><a href="#‘Ruler-Computer’" class="headerlink" title="‘Ruler Computer’"></a>‘Ruler Computer’</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2022/01/06/Data-Structure-01/" data-id="cl1a78kkj000jsgu8mhvpdoo1" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DSA/">DSA</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Router-Day03" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/05/Router-Day03/" class="article-date">
  <time class="post-time" datetime="2022-01-05T09:26:42.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">05</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/05/Router-Day03/">Router Day03：Getting Started</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Something-to-say"><a href="#Something-to-say" class="headerlink" title="Something to say"></a>Something to say</h3><p>Lots of things just took place in my life,and for me , like graduation,like getting into my Postgraduate Exam for the second time… However, after all this , I just woke up by seeing all my teammates getting a promising future while I just get my silver LOL account holding a 4000+hours playing score. So I just get myself some simple goals. Within 5 years, I’ll be at that Pwn2Own match . Just see it ,dudes. XySherlock is coming! From nowadays, I’ll write all my tech blogs by English. This aims at practicing my English skills and also decrease the difficulty of reading papers or just getting familiar with English.<br>So much for chatting, Let’s start to work for daydreaming!</p>
<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>For my start, I got the book 《揭秘家用路由器0day漏洞技术》 for my router security study , if there were some foreign friends watching my blog, just don’t be envy , I felt the same as you do now when there once goes some English awesome books.XD </p>
<h1 id="22-01-03-22-01-05"><a href="#22-01-03-22-01-05" class="headerlink" title="22/01/03-22/01/05"></a>22/01/03-22/01/05</h1><p>Learing basic operation about GCC&amp;GDB, and find my ubuntu 16 virtual environment back .<br>These works are simple , while I still got some problems here.</p>
<h3 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h3><ol>
<li>What’s the relationship between stack and stack frame and frame?<br>Got some related things:<br><a href="https://zhuanlan.zhihu.com/p/77663680" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/77663680</a>;<br><a href="https://blog.csdn.net/ylyuanlu/article/details/18947951;https://blog.csdn.net/yu97271486/article/details/80425089" target="_blank" rel="noopener">https://blog.csdn.net/ylyuanlu/article/details/18947951;https://blog.csdn.net/yu97271486/article/details/80425089</a></li>
</ol>
<p>Stack is a data structure.<strong>Every time a function call took place</strong> in this stack, the compiler uses <strong>ebp(extended base pointer)</strong> to maintain an independent <strong>stack frame</strong> on <strong>call stack</strong>.</p>
<p>And for using ebp there still needs some explanation. Stack is a FILO structure. The address grows from high address to low address. So EBP is sometimes called frame pointer and ESP(extended stack pointer) is called stack pointer. </p>
<ol start="2">
<li>How X86 hardware achieves stack and heap? Tech about heap?</li>
</ol>
<p>Learn Data structure(0/100)</p>
<ol start="3">
<li>Why PC relative addressing moves 2 bit left and do sign extension?</li>
</ol>
<p>About MIPS addressing I got:<br><a href="https://www.cs.uregina.ca/Links/class-info/201/SPIM-AddressingMode/lecture.html" target="_blank" rel="noopener">https://www.cs.uregina.ca/Links/class-info/201/SPIM-AddressingMode/lecture.html</a><br><a href="https://www.youtube.com/watch?v=Nkia4IWTEA4" target="_blank" rel="noopener">https://www.youtube.com/watch?v=Nkia4IWTEA4</a></p>
<p>For bytes coming into words, there goes the “shifting two to left” like 3(011)coming into 12(01100).</p>
<p>And I think there goes two images might be used often:<br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220105_01.PNG" alt="Image"><br><img src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/220105_02.PNG" alt="Image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2022/01/05/Router-Day03/" data-id="cl1a78kku000ssgu83c1dq4yq" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/">IoT</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Pwn01" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/13/Pwn01/" class="article-date">
  <time class="post-time" datetime="2019-04-12T17:43:52.000Z" itemprop="datePublished">
    <span class="post-month">4月</span><br>
    <span class="post-day">13</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/13/Pwn01/">Pwn01</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="SCUctf2018-Pwn00"><a href="#SCUctf2018-Pwn00" class="headerlink" title="SCUctf2018 Pwn00"></a>SCUctf2018 Pwn00</h3><p>师傅选择了这道入门栈溢出来作为我玩pwn的第一道题。<br>先是查一下文件<br><img src="https://github.com/XySherlock/Images/blob/master/screenshots/19041302.png" alt="image1"></p>
<p>首先是题目 丢进IDA看了发现有个magic函数调用了system帮我们解决了问题（爽到）<br>然后就是调调调<br><img src="https://github.com/XySherlock/Images/blob/master/screenshots/19041301.png" alt="image1"></p>
<p>从IDA的结果中我们容易看到buf这个局部变量距离ebp的距离是0x20h.我们只需要传一个0x20h的数据把局部变量预留区域塞满，再填掉前一栈帧的ebp，就可以用我们写的返回地址覆盖原函数的返回地址，进而调用程序预留的后门(magic)</p>
<p>之后就快乐写jo本</p>
<p><img src="https://github.com/XySherlock/Images/blob/master/screenshots/19041303.png" alt="image1"></p>
<p>写完能跑 </p>
<p>成了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2019/04/13/Pwn01/" data-id="cl1a78kkq000qsgu84r5kek6x" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pwn-100-greenie/">Pwn 100%greenie</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Pwn00" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/01/Pwn00/" class="article-date">
  <time class="post-time" datetime="2018-12-31T16:00:00.000Z" itemprop="datePublished">
    <span class="post-month">1月</span><br>
    <span class="post-day">01</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/01/Pwn00/">Pwn00(菜鸡的Pwn入门)</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="一、写在最开始"><a href="#一、写在最开始" class="headerlink" title="一、写在最开始"></a>一、写在最开始</h5><p>这是一个菜鸡学习pwn的记录。主要作用是帮助自己进行记忆<del>因为我是金鱼精</del>，防止自己忘记必要知识，方便复习。<br>当然如果这个系列的文章帮到你了，我会很荣幸。</p>
<h2 id="二、入门基础知识"><a href="#二、入门基础知识" class="headerlink" title="二、入门基础知识"></a>二、入门基础知识</h2><p>首先，我们需要知道函数调用的相关信息，以及栈溢出的基本知识，（在我入门的这最初一段时间里我几乎可以遇见地会一直和栈溢出死磕到底。）栈溢出的知识又有很多相关的东西。我把这篇文章命名为00是因为我将会随时修改这篇文章里面存在的基础知识。大部分会是增添。</p>
<p>①栈帧</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2019/01/01/Pwn00/" data-id="cl1a78kko000osgu8udigbwc4" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pwn-100-greenie/">Pwn 100%greenie</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-181130" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/181130/" class="article-date">
  <time class="post-time" datetime="2018-11-29T14:25:58.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br>
    <span class="post-day">29</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/181130/">181130()</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2018/11/29/181130/" data-id="cl1a78kkl000lsgu8p9htuxz0" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reverse/">reverse</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-hello-world" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/11/hello-world/" class="article-date">
  <time class="post-time" datetime="2018-11-11T11:57:00.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/11/hello-world/">Welcome</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我是一个来自中国成都的二进制学习者。目前在学习逆向的过程中。水平有限，欢迎交流。</p>
<p>除了二进制以外的爱好是兵击（hema）和贝斯。</p>
<p>拼尽全力 然后 剩下的事情就是命运说了算了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2018/11/11/hello-world/" data-id="cl1a78kky000zsgu8a1ykkbg4" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>




  
    <article id="post-181004" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/04/181004/" class="article-date">
  <time class="post-time" datetime="2018-10-04T11:50:33.000Z" itemprop="datePublished">
    <span class="post-month">10月</span><br>
    <span class="post-day">04</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/04/181004/">181004(隐藏进程)</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、隐藏进程："><a href="#一、隐藏进程：" class="headerlink" title="一、隐藏进程："></a>一、隐藏进程：</h3><p>隐藏进程：隐藏特定进程的技术（stealth process），专业术语叫Rootkit，指通过修改（Hooking）系统内核来隐藏进程、文件、注册表的一种技术。<br>IAT钩取通过操作进程的特定IAT值来实现API钩取，而API代码修改技术则将API代码的前五个字节修改为JMP XXXXXXXX来钩取API。<br>（1）正常调用API时<br>调用API时，首先使用CALL 指令调用API，在相应API执行完毕后，返回到调用代码的下一条指令的地址处。<br>（2）钩取之后：</p>
<p>首先把dll注入目标进程，API起始地址5个字节代码被修改为JMP XXXXXXXX（仅修改五个字节），在我们的XXXXXXXX的位置,首先把APi修改回原样然后调用一次，之后钩取。<br>注：当API的前五个字节是我们修改过后的时，也即API被钩取。<br>    使用API代码修改技术可以钩取进程中使用的任意API。要钩取的API代码长度要大于五个字节但是所有API代码长度都大于5个字节。</p>
<p>进程隐藏，用户模式下最常用的是ntdll.ZwQuery-SystemInformation()API钩取技术。</p>
<p>为了隐藏某个特定进程，要潜入其他所有进程内存，钩取相关API。</p>
<p>用户模式下检测进程的API分为2类<br>1、    CreateToolhelp32Snapshot()&amp;EnumProcess()</p>
<p>2、    ZwQuerySystemInformation()<br>  该API可以获取运行中的所有进程信息（结构体）,形成一个链表。操作该链表即可隐藏相关进程。<br>  因此我们需要“全局”(global)钩取来实现钩取系统中运行的所有进程的ZwQuerySystemInformation（）API。</p>
<h4 id="练习实例"><a href="#练习实例" class="headerlink" title="练习实例"></a>练习实例</h4><p>1、练习#1<br>在虚拟机中按照书上的格式使用书中提供的程序。但是注入失败。经检测发现dll注入正常，经过分析可能是虚拟机自带的procexp是魔改版本，可以保护自身不被dll注入。所以“notepad.exe”并未消失.</p>
<p>使用CreateToolhelp32Snapshot（）获取系统中运行的所有进程的列表，然后使用Process32First（）与Process32Next（）将获取的进程信息存放到PROCESSENTRY32结构体变量pe中进而获取进程的PID.</p>
<p>在代码的注入中，分析源代码发现进程PID小于100的程序我们就没有操作。（系统进程）</p>
<p>这段代码中，我们先创建名为”.SHARE”的共享内存节区，然后创建g_szProcName缓冲区，最后再由导出函数SetProcName()将要隐藏的进程名称保存到g_szProcName中。</p>
<p>JMP加地址  E9 XXXXXXXX 其中XXXXXXXX=要跳转的地址-当前指令地址-当前指令长度</p>
<p>###二、全局API钩取<br>全局API钩取针对的进程为：（1）当前运行的所有进程（2）将来要运行的所有进程<br>Kernel32.CreateProcess()被用来创建新进程。因此如果钩取了Kernel32.CreateProcess()那么之后父进程使用它创建的所有子进程都会被注入。<br>但是要注意（1）还要钩取CreateProcessA()、CreateProcessW()2个API（ASCII和Unicode版本） (2)微软部分软件会调用CreateProcessInternalA/W这两个上述API内部的函数。（若可能，尽量钩取低级API） 。<br>ntdll.ZwResumeThread（）API ，比CreateProcess（）更低级，钩取效果更好。<br>ZwResumeThread()函数在进程创建后，主线程运行前被调用执行（在CreateProcess（）API内部调用执行）。但该API尚未被公开，可能会被更改，因此可能在未来的时间钩取操作无法运行。</p>
<h4 id="练习实例-1"><a href="#练习实例-1" class="headerlink" title="练习实例"></a>练习实例</h4><p> 按照书中所说我们把”stealth2.dll”导入系统目录的system32文件夹，并运行了程序</p>
<p>这次和书中的预期结果相同，procExp进程和任务管理器中的“notepad.exe”进程隐藏了。<br>与实验1的不同是在本次的stealth2.dll中，添加了钩取CreateProcessA()和CreateProcessW（）API的代码.<br>值得注意的是钩取尚未公开的API时，一定要检查它在当前的OS版本中能否正常运行。</p>
<p>###三、 利用“热补丁”技术钩取API<br>API代码修改技术修改过后的API每次被在程序内部调用时，我们的钩取函数就会被调用执行，不断的“脱钩”/挂钩。造成整体性能地下，更严重的是在多线程环境下还会产生运行时错误。当一个线程尝试运行某段代码时，若另一线程正在对该段代码进行“写”操作，这时就会出现冲突，最后引发运行时错误。<br>因此，我们需要“热补丁”（Hot Patch/Hot Fix）技术比修改5个字节代码的方法更稳定。热补丁将会修改7个字节代码。<br>常用API的起始代码部分会以”MOV EDI,EDI”开始（IA-32：0x8BFF）,API代码上方有5个NOP指令（IA-32:0x90）。<br> MOV EDI，EDI 2个字节，NOP 1个字节。 这七个字节的指令没有任何意义。<br>我们将API起始代码之前的5个字节修改为FAR JMP指令，跳转到用户钩取函数处，然后将API其实代码的2个字节修改为SHORT JMP指令。通过这种我们称为“二次跳转”的技术就完成了对指定API的钩取操作。通过热补丁技术钩取的API并未对原API进行修改，可以用”原API地址+2”开始执行原API。</p>
<h4 id="练习实例-2"><a href="#练习实例-2" class="headerlink" title="练习实例"></a>练习实例</h4><p>按照书中的实验原理很容易理解，我们来看源码。</p>
<p>在这里的pBuf【5】申明为{0xE9,0}，之后使用两次memcpy函数先把 “JMP XXXXXXXX”的XXXXXXX写进去，然后把整个“JMP XXXXXXXX”写到API前的那五个字节。然后用memcpy把MOV EDI,EDI替换为JMP YY指令。<br>值得注意的是热补丁API钩取技术使用时必须满足它的使用条件。如果不满足使用条件那么就只能使用五字节代码修改技术。<br>Ntdll.dll中提供的API代码都较短，钩取这些API的时候有一种非常好的方法，将原API备份到用户内存区域，然后使用5字节代码修改技术修改原API的起始部分。 由于API代码较短且代码内部地址无依赖性，因此非常适合使用这一技术钩取。但这一技术需要处理重定位的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://XySherlock.github.io/2018/10/04/181004/" data-id="cl1a78kki000hsgu8lp1pnx6j" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reverse/">reverse</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">XySherlock&#39;s Secret Base</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/XySherlock/Images/master/screenshots/XySher.png">
    <h2 class="author">XySherlock</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>19</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>5</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="https://github.com/XySherlock/" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2021 - 2022 XySherlock<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title="" class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title="" class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>